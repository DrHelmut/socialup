var CLIENT_ID,CLIENT_SECRET,Q,REDIRECT_URI,fs,getOAuthURL,getUserInfo,http,https,postMessage,pushCode,querystring,request;https=require("https"),http=require("http"),request=require("request"),Q=require("q"),fs=require("fs"),querystring=require("querystring"),CLIENT_ID=process.env.LINKEDIN_CLIENT_ID,CLIENT_SECRET=process.env.LINKEDIN_CLIENT_SECRET,REDIRECT_URI=process.env.APP_URL+"/linkedin2callback",getOAuthURL=function(){return"https://www.linkedin.com/uas/oauth2/authorization?response_type=code&client_id="+CLIENT_ID+"&redirect_uri="+REDIRECT_URI},pushCode=function(e){var r,t,n,o;return r=Q.defer(),t=querystring.stringify({client_id:CLIENT_ID,client_secret:CLIENT_SECRET,redirect_uri:REDIRECT_URI,grant_type:"authorization_code",code:e}),n={host:"www.linkedin.com",port:443,path:"/uas/oauth2/accessToken",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":t.length}},o=https.request(n,function(e){return e.setEncoding("utf8"),e.on("data",function(e){return r.resolve(JSON.parse(e))})}),o.on("error",function(e){return r.reject(new Error(e))}),o.write(t),o.end(),r.promise},getUserInfo=function(e){var r,t,n;return r=Q.defer(),n={host:"api.linkedin.com",port:443,path:"/v1/people/~?format=json",method:"GET",headers:{Authorization:"Bearer "+e.access_token}},t=https.request(n,function(e){var t;return t="",e.on("data",function(e){return t+=e}),e.on("end",function(){var e;return e=JSON.parse(t),r.resolve({userName:e.firstName+" "+e.lastName})})}),t.on("error",function(e){return console.log("get user infos error: ",e),r.reject(new Error(e))}),t.end(),r.promise},postMessage=function(e,r){var t,n;return t=Q.defer(),n={comment:r,visibility:{code:"anyone"}},request({uri:"https://api.linkedin.com/v1/people/~/shares?format=json",auth:{bearer:e.access_token},method:"POST",json:!0,body:n},function(e,r,n){return e?t.reject(new Error(e)):400===n.status?t.reject(new Error(n.message)):t.resolve(n)}),t.promise},exports.getOAuthURL=getOAuthURL,exports.pushCode=pushCode,exports.getUserInfo=getUserInfo,exports.postMessage=postMessage;